var senator_data = [{"Name":"Richard Shelby","State":"Alabama","Party":"Republican","Age":"85"},{"Name":"Doug Jones","State":"Alabama","Party":"Democratic","Age":"65"},{"Name":"Lisa Murkowski","State":"Alaska","Party":"Republican","Age":"62"},{"Name":"Dan Sullivan","State":"Alaska","Party":"Republican","Age":"55"},{"Name":"Kyrsten Sinema","State":"Arizona","Party":"Democratic","Age":"43"},{"Name":"Martha McSally","State":"Arizona","Party":"Republican","Age":"53"},{"Name":"John Boozman","State":"Arkansas","Party":"Republican","Age":"69"},{"Name":"Tom Cotton","State":"Arkansas","Party":"Republican","Age":"42"},{"Name":"Dianne Feinstein","State":"California","Party":"Democratic","Age":"86"},{"Name":"Kamala Harris","State":"California","Party":"Democratic","Age":"55"},{"Name":"Michael Bennet","State":"Colorado","Party":"Democratic","Age":"55"},{"Name":"Cory Gardner","State":"Colorado","Party":"Republican","Age":"45"},{"Name":"Richard Blumenthal","State":"Connecticut","Party":"Democratic","Age":"74"},{"Name":"Chris Murphy","State":"Connecticut","Party":"Democratic","Age":"46"},{"Name":"Tom Carper","State":"Delaware","Party":"Democratic","Age":"73"},{"Name":"Chris Coons","State":"Delaware","Party":"Democratic","Age":"56"},{"Name":"Marco Rubio","State":"Florida","Party":"Republican","Age":"48"},{"Name":"Rick Scott","State":"Florida","Party":"Republican","Age":"67"},{"Name":"David Perdue","State":"Georgia","Party":"Republican","Age":"70"},{"Name":"Kelly Loeffler","State":"Georgia","Party":"Republican","Age":"49"},{"Name":"Brian Schatz","State":"Hawaii","Party":"Democratic","Age":"47"},{"Name":"Mazie Hirono","State":"Hawaii","Party":"Democratic","Age":"72"},{"Name":"Mike Crapo","State":"Idaho","Party":"Republican","Age":"68"},{"Name":"Jim Risch","State":"Idaho","Party":"Republican","Age":"76"},{"Name":"Dick Durbin","State":"Illinois","Party":"Democratic","Age":"75"},{"Name":"Tammy Duckworth","State":"Illinois","Party":"Democratic","Age":"52"},{"Name":"Todd Young","State":"Indiana","Party":"Republican","Age":"47"},{"Name":"Mike Braun","State":"Indiana","Party":"Republican","Age":"65"},{"Name":"Chuck Grassley","State":"Iowa","Party":"Republican","Age":"86"},{"Name":"Joni Ernst","State":"Iowa","Party":"Republican","Age":"49"},{"Name":"Pat Roberts","State":"Kansas","Party":"Republican","Age":"83"},{"Name":"Jerry Moran","State":"Kansas","Party":"Republican","Age":"65"},{"Name":"Mitch McConnell","State":"Kentucky","Party":"Republican","Age":"78"},{"Name":"Rand Paul","State":"Kentucky","Party":"Republican","Age":"57"},{"Name":"Bill Cassidy","State":"Louisiana","Party":"Republican","Age":"62"},{"Name":"John Kennedy","State":"Louisiana","Party":"Republican","Age":"68"},{"Name":"Susan Collins","State":"Maine","Party":"Republican","Age":"67"},{"Name":"Angus King","State":"Maine","Party":"Independent[a]","Age":"75"},{"Name":"Ben Cardin","State":"Maryland","Party":"Democratic","Age":"76"},{"Name":"Chris Van Hollen","State":"Maryland","Party":"Democratic","Age":"61"},{"Name":"Elizabeth Warren","State":"Massachusetts","Party":"Democratic","Age":"70"},{"Name":"Ed Markey","State":"Massachusetts","Party":"Democratic","Age":"73"},{"Name":"Debbie Stabenow","State":"Michigan","Party":"Democratic","Age":"69"},{"Name":"Gary Peters","State":"Michigan","Party":"Democratic","Age":"61"},{"Name":"Amy Klobuchar","State":"Minnesota","Party":"Democratic","Age":"59"},{"Name":"Tina Smith","State":"Minnesota","Party":"Democratic","Age":"62"},{"Name":"Roger Wicker","State":"Mississippi","Party":"Republican","Age":"68"},{"Name":"Cindy Hyde-Smith","State":"Mississippi","Party":"Republican","Age":"60"},{"Name":"Roy Blunt","State":"Missouri","Party":"Republican","Age":"70"},{"Name":"Josh Hawley","State":"Missouri","Party":"Republican","Age":"40"},{"Name":"Jon Tester","State":"Montana","Party":"Democratic","Age":"63"},{"Name":"Steve Daines","State":"Montana","Party":"Republican","Age":"57"},{"Name":"Deb Fischer","State":"Nebraska","Party":"Republican","Age":"69"},{"Name":"Ben Sasse","State":"Nebraska","Party":"Republican","Age":"48"},{"Name":"Catherine Cortez Masto","State":"Nevada","Party":"Democratic","Age":"55"},{"Name":"Jacky Rosen","State":"Nevada","Party":"Democratic","Age":"62"},{"Name":"Jeanne Shaheen","State":"New Hampshire","Party":"Democratic","Age":"73"},{"Name":"Maggie Hassan","State":"New Hampshire","Party":"Democratic","Age":"62"},{"Name":"Bob Menendez","State":"New Jersey","Party":"Democratic","Age":"66"},{"Name":"Cory Booker","State":"New Jersey","Party":"Democratic","Age":"50"},{"Name":"Tom Udall","State":"New Mexico","Party":"Democratic","Age":"71"},{"Name":"Martin Heinrich","State":"New Mexico","Party":"Democratic","Age":"48"},{"Name":"Chuck Schumer","State":"New York","Party":"Democratic","Age":"69"},{"Name":"Kirsten Gillibrand","State":"New York","Party":"Democratic","Age":"53"},{"Name":"Richard Burr","State":"North Carolina","Party":"Republican","Age":"64"},{"Name":"Thom Tillis","State":"North Carolina","Party":"Republican","Age":"59"},{"Name":"John Hoeven","State":"North Dakota","Party":"Republican","Age":"63"},{"Name":"Kevin Cramer","State":"North Dakota","Party":"Republican","Age":"59"},{"Name":"Sherrod Brown","State":"Ohio","Party":"Democratic","Age":"67"},{"Name":"Rob Portman","State":"Ohio","Party":"Republican","Age":"64"},{"Name":"Jim Inhofe","State":"Oklahoma","Party":"Republican","Age":"85"},{"Name":"James Lankford","State":"Oklahoma","Party":"Republican","Age":"52"},{"Name":"Ron Wyden","State":"Oregon","Party":"Democratic","Age":"70"},{"Name":"Jeff Merkley","State":"Oregon","Party":"Democratic","Age":"63"},{"Name":"Bob Casey Jr.","State":"Pennsylvania","Party":"Democratic","Age":"59"},{"Name":"Pat Toomey","State":"Pennsylvania","Party":"Republican","Age":"58"},{"Name":"Jack Reed","State":"Rhode Island","Party":"Democratic","Age":"70"},{"Name":"Sheldon Whitehouse","State":"Rhode Island","Party":"Democratic","Age":"64"},{"Name":"Lindsey Graham","State":"South Carolina","Party":"Republican","Age":"64"},{"Name":"Tim Scott","State":"South Carolina","Party":"Republican","Age":"54"},{"Name":"John Thune","State":"South Dakota","Party":"Republican","Age":"59"},{"Name":"Mike Rounds","State":"South Dakota","Party":"Republican","Age":"65"},{"Name":"Lamar Alexander","State":"Tennessee","Party":"Republican","Age":"79"},{"Name":"Marsha Blackburn","State":"Tennessee","Party":"Republican","Age":"67"},{"Name":"John Cornyn","State":"Texas","Party":"Republican","Age":"68"},{"Name":"Ted Cruz","State":"Texas","Party":"Republican","Age":"49"},{"Name":"Mike Lee","State":"Utah","Party":"Republican","Age":"48"},{"Name":"Mitt Romney","State":"Utah","Party":"Republican","Age":"73"},{"Name":"Patrick Leahy","State":"Vermont","Party":"Democratic","Age":"79"},{"Name":"Bernie Sanders","State":"Vermont","Party":"Independent[a]","Age":"78"},{"Name":"Mark Warner","State":"Virginia","Party":"Democratic","Age":"65"},{"Name":"Tim Kaine","State":"Virginia","Party":"Democratic","Age":"62"},{"Name":"Patty Murray","State":"Washington","Party":"Democratic","Age":"69"},{"Name":"Maria Cantwell","State":"Washington","Party":"Democratic","Age":"61"},{"Name":"Joe Manchin","State":"West Virginia","Party":"Democratic","Age":"72"},{"Name":"Shelley Moore Capito","State":"West Virginia","Party":"Republican","Age":"66"},{"Name":"Ron Johnson","State":"Wisconsin","Party":"Republican","Age":"64"},{"Name":"Tammy Baldwin","State":"Wisconsin","Party":"Democratic","Age":"58"},{"Name":"Mike Enzi","State":"Wyoming","Party":"Republican","Age":"76"},{"Name":"John Barrasso","State":"Wyoming","Party":"Republican","Age":"67"}];


var infection_rate = 0.5;
var age_ranges = [[40,49],[50,59], [60,69], [70,79],[80,1000]]
var death_rates = [0.004, 0.013, 0.036, 0.08, 0.148]

function AgeIndex(age, age_ranges)
{
    for(var i = 0; i < age_ranges.length; i++)
    {
      if(age >= age_ranges[i][0] && age <= age_ranges[i][1])
      {
        return i;
      }
    }
    return -1;
}

function TestFatality(senator)
{
    var age = parseInt(senator.Age);
    var age_index = AgeIndex(age, age_ranges);
    var death_rate = death_rates[age_index];
    var dies = Math.random() < death_rate;
    return dies;
}

function SelectRandomSenators(senators, number)
{
  var senators_shuffled = senators.slice(0), i = senators.length, temp, index;
  while (i--) {
    index = Math.floor((i + 1) * Math.random());
    temp = senators_shuffled[index];
    senators_shuffled[index] = senators_shuffled[i];
    senators_shuffled[i] = temp;
  }
  return senators_shuffled.slice(0, number);
}

function UpdateInfectionRate(rate)
{
  infection_rate = rate / 100.0;
  var readout_element = document.getElementById("infection_rate_readout");
  readout_element.innerHTML = "Infection Rate: " + String(rate) + "%";
}

function RunSimulation()
{
  n_infections = Math.round(senator_data.length * infection_rate);
  random_senators = SelectRandomSenators(senator_data, n_infections);
  dead_senators = [];
  for(var i = 0; i < n_infections; i++)
  {
    if(TestFatality(random_senators[i]))
    {
      dead_senators.push(random_senators[i]);
    }
  }
  UpdateFatalityList(dead_senators);
}

function CompareSenatorParty(s1, s2)
{
  if(s1.Party[0] == "R")
  {
    return -1;
  }
  else if(s1.Party[0] == "D")
  {
    if(s2.Party[0] == "R")
    {
      return 1;
    }
    else {
      return -1;
    }
  }
  else {
    return 1;
  }
}

function UpdateFatalityList(dead_senators)
{
  var output_message = "<br><p><b>Fatalities:</b></p>";
  var output_element = document.getElementById(id="fatality_list");
  if(dead_senators.length == 0)
  {
    output_message +="<p>  0 Fatalities</p>";
  }
  else {
    dead_senators.sort(CompareSenatorParty);
    for(var i = 0; i < dead_senators.length; i++)
    {
      var party = String(dead_senators[i].Party);
      party
      if(party == "Republican")
      {
        output_message += '<p> ðŸŸ¥';
      }else if (party == "Democratic") {
        output_message += '<p> ðŸŸ¦';
      }
      else {
          output_message += '<p> ðŸŸ¨';
      }
      output_message += (' ' + dead_senators[i].Name
              + ': (' + party[0] + ' - ' + dead_senators[i].State + ')</p>');
      console.log(dead_senators[0].Name);
    }
  }
  output_element.innerHTML = output_message;
}
